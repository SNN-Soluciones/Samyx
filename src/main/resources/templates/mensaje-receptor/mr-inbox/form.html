<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/layout :: head}"></head>
<body class="fix-header card-no-border logo-center">

<div id="main-wrapper">
	<header th:replace="~{layout/layout :: header}"></header>
	<aside th:replace="~{layout/layout :: aside}"></aside>

	<div class="page-wrapper">
		<div class="page-header">
			<div class="page-header-content">
				<div class="page-title">
					<h1><i class="fas fa-envelope-open-text"></i> <span th:text="#{txt.mensaje.receptor}"></span></h1>
				</div>
				<div class="page-breadcrumb">
					<nav aria-label="breadcrumb">
						<ol class="breadcrumb">
							<li class="breadcrumb-item">
								<a th:href="@{/mensaje-receptor-inbox/}">
									<i class="fas fa-home"></i> <span th:text="#{txt.inicio}"></span>
								</a>
							</li>
							<li class="breadcrumb-item active" th:text="#{txt.mensaje.receptor}"></li>
						</ol>
					</nav>
				</div>
			</div>
		</div>

		<div class="container-fluid">
			<div class="row">
				<div class="col-12">
					<div class="main-card">
						<div class="card-body">
							<textarea style="display: none;" onchange='readXml(event, "resumen")' class="form-control" id="loadFacturaXml" rows="20" cols="" th:text="${facturaXmlFinal}"></textarea>

							<form method="post" id="formAddMensajeReceptor" autocomplete="off" th:object="${mensajeReceptor}" th:action="@{/mensaje-receptor/recepcion}">
								<input type="hidden" name="form" value="inbox" />
								<input type="hidden" name="idMrInbox" th:value="${idMrInbox}" />
								<input type="hidden" th:field="*{codigoActividad}" />
								<input type="hidden" th:field="*{clave}" />
								<input type="hidden" th:field="*{fechaEmision}" />
								<input type="hidden" th:field="*{moneda}" />
								<input type="hidden" th:field="*{condicionVenta}" />
								<input type="hidden" th:field="*{plazoCredito}" />
								<input type="hidden" th:field="*{medioPago}" />
								<input type="hidden" th:field="*{tipoCambio}" />
								<input type="hidden" id="restarAIvaTotal" />

								<!-- Aceptación del Documento -->
								<div class="form-section">
									<h3 class="section-title">
										<i class="fas fa-check-circle"></i> Aceptación del Documento
									</h3>
									<div class="row">
										<div class="col-md-3">
											<div class="form-group">
												<label class="control-label">
													<i class="fas fa-file-alt"></i> Tipo de documento
												</label>
												<select th:field="*{tipoDocumento}" class="form-control custom-select" id="tipoDocumento" required="required">
													<option value="05">Aceptación Total</option>
													<option value="06">Aceptación Parcial</option>
													<option value="07">Rechazo Documento</option>
												</select>
											</div>
										</div>

										<div class="col-md-3">
											<div class="form-group">
												<label class="control-label">
													<i class="fas fa-percentage"></i> [(#{txt.mr.condicion.de.impuesto})]
												</label>
												<select th:field="*{condicionImpuesto}" class="form-control custom-select" id="condicionImpuesto" required="required">
													<option value="01">Genera crédito IVA</option>
													<option value="02">Genera crédito parcial del IVA</option>
													<option value="03">Bienes de capital</option>
													<option value="04">No Genera crédito</option>
													<option value="05">Proporcionalidad</option>
												</select>
											</div>
										</div>

										<div class="col-md-3">
											<div class="form-group">
												<label class="control-label">
													<i class="fas fa-coins"></i> [(#{txt.mr.monto.de.impuesto.a.acreditar})]
												</label>
												<input type="text" readonly="readonly" th:field="*{montoTotalImpuestoAcreditar}" class="form-control" onkeypress="return validateFloatKeyPress(this,event);" value="0.00">
											</div>
										</div>

										<div class="col-md-3">
											<div class="form-group">
												<label class="control-label">
													<i class="fas fa-dollar-sign"></i> [(#{txt.mr.monto.total.de.gasto.a.aplicar})]
												</label>
												<input type="text" readonly="readonly" th:field="*{montoTotalDeGastoAplicable}" class="form-control" onkeypress="return validateFloatKeyPress(this,event);" value="0.00">
											</div>
										</div>

										<div class="col-md-12">
											<div class="form-group">
												<label class="control-label">
													<i class="fas fa-comment-alt"></i> [(#{txt.mr.detalle})]
												</label>
												<textarea th:field="*{detalleMensaje}" class="form-control" th:attr="placeholder=#{txt.mr.detalle.placeholder}" required="required" rows="3"></textarea>
											</div>
										</div>
									</div>
								</div>

								<!-- Resumen del Emisor -->
								<div class="form-section">
									<h3 class="section-title">
										<i class="fas fa-building"></i> [(#{txt.mr.resumen.emisor})]
									</h3>
									<div class="row">
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.nombre.emisor})]</label>
												<input readonly="readonly" th:field="*{emisorMr}" class="form-control">
											</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.nombre.comercial.emisor})]</label>
												<input readonly="readonly" th:field="*{nombreComercialEmisorMr}" class="form-control">
											</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.correo})]</label>
												<input readonly="readonly" th:field="*{correoEmisorMr}" class="form-control">
											</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.tipo.cedula.emisor})]</label>
												<input readonly="readonly" th:field="*{tipoIdentificacionEmisorMr}" class="form-control">
											</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.cedula.emisor})]</label>
												<input readonly="readonly" th:field="*{identificacionEmisorMr}" class="form-control">
											</div>
										</div>
									</div>
								</div>

								<!-- Resumen del Receptor -->
								<div class="form-section">
									<h3 class="section-title">
										<i class="fas fa-user-tie"></i> [(#{txt.mr.resumen.receptor})]
									</h3>
									<div class="row">
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.nombre.receptor})]</label>
												<input readonly="readonly" th:field="*{nombreReceptorMr}" class="form-control">
											</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.nombre.comercial.receptor})]</label>
												<input readonly="readonly" th:field="*{nombreComercialReceptorMr}" class="form-control">
											</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.tipo.cedula.receptor})]</label>
												<input readonly="readonly" th:field="*{tipoIdentificacionReceptorMr}" class="form-control">
											</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<label class="control-label">[(#{txt.mr.cedula.receptor})]</label>
												<input readonly="readonly" th:field="*{identificacionReceptorMr}" class="form-control">
											</div>
										</div>
									</div>
								</div>

								<!-- Resumen de la Factura -->
								<div class="form-section">
									<h3 class="section-title">
										<i class="fas fa-file-invoice-dollar"></i> [(#{txt.mr.resumen.factura})]
									</h3>

									<!-- Detalle de líneas -->
									<div class="table-responsive">
										<table class="table table-hover">
											<thead>
											<tr>
												<th>Línea</th>
												<th>Código</th>
												<th>Cantidad</th>
												<th>Unidad</th>
												<th>Detalle</th>
												<th>Precio</th>
												<th>Total</th>
												<th>SubTotal</th>
												<th>Descuento</th>
												<th>Impuesto</th>
												<th>Impuesto Neto</th>
												<th>Total Línea</th>
											</tr>
											</thead>
											<tbody id="lineasFactura">
											<!-- Líneas generadas dinámicamente -->
											</tbody>
										</table>
									</div>

									<!-- Totales -->
									<div class="totals-section">
										<div class="row">
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total serv gravados</label>
													<input readonly="readonly" th:field="*{totalServGravados}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total serv exentos</label>
													<input readonly="readonly" th:field="*{totalServExentos}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total serv exonerado</label>
													<input readonly="readonly" th:field="*{totalServExonerado}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total merc gravadas</label>
													<input readonly="readonly" th:field="*{totalMercGravadas}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total merc exentas</label>
													<input readonly="readonly" th:field="*{totalMercExentas}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total merc exonerada</label>
													<input readonly="readonly" th:field="*{totalMercExonerada}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total gravado</label>
													<input readonly="readonly" th:field="*{totalGravados}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total exento</label>
													<input readonly="readonly" th:field="*{totalExentos}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total exonerado</label>
													<input readonly="readonly" th:field="*{totalExonerado}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total ventas</label>
													<input readonly="readonly" th:field="*{totalVentas}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total descuentos</label>
													<input readonly="readonly" th:field="*{totalDescuentos}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total venta neta</label>
													<input readonly="readonly" th:field="*{totalVentaNeta}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total impuestos</label>
													<input readonly="readonly" th:field="*{impuestos}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total IVA devuelto</label>
													<input readonly="readonly" th:field="*{totalIVADevuelto}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group">
													<label class="control-label">Total otros cargos</label>
													<input readonly="readonly" th:field="*{totalOtrosCargos}" class="form-control">
												</div>
											</div>
											<div class="col-md-2">
												<div class="form-group total-comprobante">
													<label class="control-label">[(#{txt.total.comprobante})]</label>
													<input readonly="readonly" th:field="*{totalFactura}" class="form-control">
												</div>
											</div>
										</div>
									</div>

									<div class="form-actions">
										<input type="hidden" id="ivaTotal" class="form-control">
										<button type="submit" class="btn btn-primary btn-lg" id="btn-procesar-mr">
											<i class="fas fa-save"></i> [(#{txt.aceptar.factura})]
										</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>

		<footer th:replace="~{layout/layout :: footer}"></footer>
		<input id="csrfToken" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	</div>
</div>

<div th:replace="~{layout/layout :: scripts}"></div>
<link th:href="@{/css/pages/mensaje-receptor/mr-automatico.css}" rel="stylesheet" />
<script th:src="@{/js/pages/mensaje-receptor/mr-automatico.js}"></script>
</body>
</html>