<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="es">
<head th:replace="~{layout/layout :: head}">
  <title>Empresas - SAMYX</title>
</head>
<body>
<div id="main-wrapper">
  <!-- Header -->
  <header th:replace="~{layout/layout :: header}"></header>

  <!-- Page Content -->
  <main class="py-5">
    <div class="container-fluid">

      <!-- Page Header -->
      <div class="row mb-5">
        <div class="col-md-6">
          <h1 class="h2 mb-1">
            <i class="fas fa-building me-2"></i>Gestión de Empresas
          </h1>
          <p class="text-muted mb-0">Administra todas las empresas del sistema</p>
        </div>
        <div class="col-md-6 text-md-end">
          <a sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_USER')"
             class="btn btn-primary btn-lg"
             th:href="@{/emisor/registrar-empresa/}">
            <i class="fas fa-plus-circle me-2"></i>Nueva Empresa
          </a>
        </div>
      </div>

      <!-- Search & Filters -->
      <div class="row mb-4">
        <div class="col-12">
          <form method="get" th:action="@{/emisor/}" class="d-flex gap-2">
            <input type="text"
                   name="q"
                   class="form-control"
                   placeholder="Buscar por nombre o identificación..."
                   th:value="${param.q}">
            <button type="submit" class="btn btn-outline-primary">
              <i class="fas fa-search me-2"></i>Buscar
            </button>
            <a th:if="${param.q != null}"
               class="btn btn-outline-secondary"
               th:href="@{/emisor/}">
              <i class="fas fa-times me-2"></i>Limpiar
            </a>
          </form>
        </div>
      </div>

      <!-- Empty State -->
      <div th:if="${#lists.isEmpty(listaEmisor)}" class="row">
        <div class="col-12">
          <div class="card border-0 shadow-lg">
            <div class="card-body py-5 text-center">
              <div class="mb-4">
                <i class="fas fa-search" style="font-size: 3rem; color: #ccc;"></i>
              </div>
              <h3 class="mb-2">No se encontraron empresas</h3>
              <p class="text-muted mb-4">No hay empresas que coincidan con tu búsqueda</p>
              <a th:href="@{/emisor/}" class="btn btn-primary">
                <i class="fas fa-redo me-2"></i>Volver a listar todas
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Results Info -->
      <div th:if="${!#lists.isEmpty(listaEmisor)}" class="row mb-3">
        <div class="col-12">
          <small class="text-muted">
            <i class="fas fa-info-circle me-2"></i>
            <span th:text="${#lists.size(listaEmisor)} + ' empresa(s) encontrada(s)'"></span>
          </small>
        </div>
      </div>

      <!-- Table -->
      <div th:if="${!#lists.isEmpty(listaEmisor)}" class="row">
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                <tr>
                  <th class="fw-600">
                    <i class="fas fa-building me-2"></i>Empresa
                  </th>
                  <th>Identificación</th>
                  <th>Correo</th>
                  <th>Teléfono</th>
                  <th>Certificado</th>
                  <th>Estado</th>
                  <th class="text-center" width="180">Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="empresa : ${listaEmisor}"
                    th:classappend="${!empresa.emisor.statusEmpresa} ? 'opacity-50' : ''">

                  <!-- Empresa Name -->
                  <td class="align-middle">
                    <div class="d-flex align-items-center">
                      <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                        <i class="fas fa-building text-primary"></i>
                      </div>
                      <div>
                        <strong th:text="${empresa.emisor.nombreRazonSocial}"></strong>
                        <br>
                        <small class="text-muted" th:if="${!empresa.emisor.statusEmpresa}">
                          <i class="fas fa-pause-circle me-1"></i>Inactiva
                        </small>
                      </div>
                    </div>
                  </td>

                  <!-- ID -->
                  <td class="align-middle">
                    <code class="bg-light px-2 py-1 rounded"
                          th:text="${empresa.emisor.identificacion}"></code>
                  </td>

                  <!-- Email -->
                  <td class="align-middle">
                    <a th:href="'mailto:' + ${empresa.emisor.email}"
                       class="text-decoration-none"
                       th:text="${empresa.emisor.email}"></a>
                  </td>

                  <!-- Teléfono -->
                  <td class="align-middle" th:text="${empresa.emisor.telefono ?: '-'}"></td>

                  <!-- Certificado -->
                  <td class="align-middle">
											<span th:if="${empresa.emisor.fechaCaducidadCert != null}"
                            th:text="${#dates.format(empresa.emisor.fechaCaducidadCert, 'dd/MM/yyyy')}"></span>
                    <span th:unless="${empresa.emisor.fechaCaducidadCert != null}" class="text-muted">
												-
											</span>
                  </td>

                  <!-- Estado -->
                  <td class="align-middle">
											<span class="badge"
                            th:classappend="${empresa.emisor.statusEmpresa} ? 'bg-success' : 'bg-secondary'">
												<span th:text="${empresa.emisor.statusEmpresa} ? 'Activa' : 'Inactiva'"></span>
											</span>
                  </td>

                  <!-- Acciones -->
                  <td class="align-middle text-center">
                    <div class="btn-group" role="group">
                      <a class="btn btn-sm btn-primary"
                         th:href="@{/emisor/ingresar/}+${empresa.emisor.id}"
                         title="Ingresar a la empresa">
                        <i class="fas fa-sign-in-alt"></i>
                      </a>
                      <a sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_USER')"
                         class="btn btn-sm btn-outline-secondary"
                         th:href="@{/emisor/edit/}+${empresa.emisor.id}"
                         title="Modificar empresa">
                        <i class="fas fa-edit"></i>
                      </a>
                    </div>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer th:replace="~{layout/layout :: footer}"></footer>
</div>

<!-- Scripts -->
<div th:replace="~{layout/layout :: scripts}"></div>

<!-- CSS específico de esta página -->
<link th:href="@{/css/pages/emisor-home.css}" rel="stylesheet" />
</body>
</html>