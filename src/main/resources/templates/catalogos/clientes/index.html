<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/layout :: head}"></head>
<body class="fix-header card-no-border logo-center">

<div id="main-wrapper">
  <header th:replace="~{layout/layout :: header}"></header>
  <aside th:replace="~{layout/layout :: aside}"></aside>

  <!-- Page wrapper -->
  <div class="page-wrapper">
    <!-- Bread crumb -->
    <div class="page-header">
      <div class="page-header-content">
        <div class="page-title">
          <h1>
            <i class="fas fa-users"></i>
            <span th:text="#{txt.clientes}">Clientes</span>
          </h1>
        </div>
        <div class="page-breadcrumb">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a th:href="@{/home}">
                  <i class="fas fa-home"></i>
                  <span th:text="#{txt.inicio}">Inicio</span>
                </a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                <span th:text="#{txt.clientes}">Clientes</span>
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>

    <!-- Container fluid -->
    <div class="container-fluid">
      <!-- Filtros y acciones -->
      <div class="action-bar">
        <div class="action-bar-left">
          <button type="button" class="btn-action btn-primary" th:onclick="'location.href=\'' + @{/clientes/form} + '\''">
            <i class="fas fa-user-plus"></i>
            <span>Nuevo Cliente</span>
          </button>

          <button type="button" class="btn-action btn-secondary" id="btnImportarClientes">
            <i class="fas fa-file-import"></i>
            <span>Importar</span>
          </button>

          <button type="button" class="btn-action btn-info" id="btnExportarClientes">
            <i class="fas fa-file-export"></i>
            <span>Exportar</span>
          </button>
        </div>

        <div class="action-bar-right">
          <div class="search-box">
            <form method="get" th:action="@{/clientes/}" autocomplete="off">
              <div class="search-input-group">
                <i class="fas fa-search"></i>
                <input type="search"
                       name="q"
                       class="search-input"
                       placeholder="Buscar por identificación, nombre, correo o teléfono..."
                       th:value="${param.q}">
                <button type="submit" class="search-button">
                  <span>Buscar</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Estadísticas rápidas -->
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value" th:text="${totalClientes}">0</h3>
            <p class="stat-label">Total Clientes</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <i class="fas fa-user-check"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value" th:text="${clientesActivos}">0</h3>
            <p class="stat-label">Clientes Activos</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <i class="fas fa-user-clock"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value" th:text="${clientesNuevos}">0</h3>
            <p class="stat-label">Nuevos este mes</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
            <i class="fas fa-file-invoice-dollar"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value" th:text="${totalFacturas}">0</h3>
            <p class="stat-label">Facturas Emitidas</p>
          </div>
        </div>
      </div>

      <!-- Tabla de clientes -->
      <div class="content-card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-list"></i>
            Lista de Clientes
          </h2>
          <div class="card-actions">
            <button class="btn-icon" id="btnRefresh" title="Actualizar">
              <i class="fas fa-sync-alt"></i>
            </button>
            <button class="btn-icon" id="btnFilter" title="Filtros">
              <i class="fas fa-filter"></i>
            </button>
          </div>
        </div>

        <div class="card-body">
          <!-- Mensaje cuando hay búsqueda -->
          <div class="search-results-info" th:if="${param.q}">
            <p>
              Resultados de búsqueda para: <strong th:text="${param.q}"></strong>
              <a th:href="@{/clientes/}" class="clear-search">
                <i class="fas fa-times-circle"></i> Limpiar búsqueda
              </a>
            </p>
          </div>

          <!-- Tabla responsiva -->
          <div class="table-container">
            <table class="modern-table">
              <thead>
              <tr>
                <th class="th-tipo">Tipo ID</th>
                <th class="th-identificacion">Identificación</th>
                <th class="th-nombre">Nombre Completo</th>
                <th class="th-correo">Correo Electrónico</th>
                <th class="th-telefono">Teléfono</th>
                <th class="th-provincia">Provincia</th>
                <th class="th-credito text-center">Crédito</th>
                <th class="th-estado text-center">Estado</th>
                <th class="th-acciones text-center">Acciones</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="k : ${ListaClientes}"
                  th:attr="data-id=${k.id}">

                <td class="td-tipo">
                  <span class="tipo-badge" th:text="${k.tipoDeIdentificacion.tipoDeIdentificacion}"></span>
                </td>

                <td class="td-identificacion">
                  <span class="identificacion-text" th:text="${k.identificacion}"></span>
                </td>

                <td class="td-nombre">
                  <div class="cliente-info">
                    <span class="cliente-nombre" th:text="${k.nombreCompleto}"></span>
                  </div>
                </td>

                <td class="td-correo">
                  <a th:href="'mailto:' + ${k.correo1}"
                     class="correo-link"
                     th:if="${k.correo1 != null && !#strings.isEmpty(k.correo1)}">
                    <i class="fas fa-envelope"></i>
                    <span th:text="${k.correo1}"></span>
                  </a>
                  <span th:unless="${k.correo1 != null && !#strings.isEmpty(k.correo1)}"
                        class="text-muted">
                                            Sin correo
                                        </span>
                </td>

                <td class="td-telefono">
                                        <span th:if="${k.telefono1 != null && !#strings.isEmpty(k.telefono1)}"
                                              class="telefono-text">
                                            <i class="fas fa-phone"></i>
                                            <span th:text="'+' + ${k.codigoPais} + ' ' + ${k.telefono1}"></span>
                                        </span>
                  <span th:unless="${k.telefono1 != null && !#strings.isEmpty(k.telefono1)}"
                        class="text-muted">
                                            Sin teléfono
                                        </span>
                </td>

                <td class="td-provincia">
                  <span th:text="${k.provincia?.nombre ?: 'No especificada'}"></span>
                </td>

                <td class="td-credito text-center">
                                        <span class="credito-badge"
                                              th:classappend="${k.estadoCredito == 'A'} ? 'credito-activo' : 'credito-inactivo'">
                                            <i th:class="${k.estadoCredito == 'A'} ? 'fas fa-check-circle' : 'fas fa-times-circle'"></i>
                                            <span th:text="${k.estadoCredito == 'A'} ? 'Sí' : 'No'"></span>
                                        </span>
                </td>

                <td class="td-estado text-center">
                                        <span class="estado-badge estado-activo">
                                            <span>Activo</span>
                                        </span>
                </td>

                <td class="td-acciones">
                  <div class="action-buttons">
                    <button class="btn-table-action btn-view"
                            th:onclick="'verDetalleCliente(' + ${k.id} + ')'"
                            title="Ver detalles">
                      <i class="fas fa-eye"></i>
                    </button>

                    <a class="btn-table-action btn-edit"
                       th:href="@{/clientes/edit/{id}(id=${k.id})}"
                       title="Editar">
                      <i class="fas fa-edit"></i>
                    </a>

                    <button class="btn-table-action btn-history"
                            th:onclick="'verHistorialCliente(' + ${k.id} + ')'"
                            title="Ver historial">
                      <i class="fas fa-history"></i>
                    </button>

                    <button class="btn-table-action btn-delete"
                            th:onclick="'confirmarEliminarCliente(' + ${k.id} + ')'"
                            title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
              </tbody>
            </table>

            <!-- Estado vacío -->
            <div class="empty-state" th:if="${#lists.isEmpty(ListaClientes)}">
              <div class="empty-icon">
                <i class="fas fa-user-slash"></i>
              </div>
              <h3>No hay clientes registrados</h3>
              <p th:if="${param.q}">No se encontraron clientes que coincidan con tu búsqueda</p>
              <p th:unless="${param.q}">Comienza agregando tu primer cliente</p>
              <button class="btn-primary" th:onclick="'location.href=\'' + @{/clientes/form} + '\''">
                <i class="fas fa-user-plus"></i>
                Agregar Cliente
              </button>
            </div>
          </div>

          <!-- Paginación -->
          <nav th:replace="~{layout/paginator-nav :: paginator}"></nav>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer th:replace="~{layout/layout :: footer}"></footer>
</div>

<!-- Modal detalle cliente -->
<div class="modal fade" id="modalDetalleCliente" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalle del Cliente</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body" id="detalleClienteContent">
        <!-- Contenido cargado dinámicamente -->
      </div>
    </div>
  </div>
</div>

<!-- Modal historial cliente -->
<div class="modal fade" id="modalHistorialCliente" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Historial de Compras</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body" id="historialClienteContent">
        <!-- Contenido cargado dinámicamente -->
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<div th:replace="~{layout/layout :: scripts}"></div>

<!-- CSS específico -->
<link th:href="@{/css/pages/catalogos/clientes.css}" rel="stylesheet" />

<!-- JavaScript específico -->
<script th:src="@{/js/pages/catalogos/clientes.js}"></script>
</body>
</html>